<!DOCTYPE html>
<html>
<head>


    <!-- Document Settings -->
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />


    <!--syntax.css 추가-->
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <!--font awesome-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--font -->
    <link rel="preconnect" href="https://fonts.gstatic.com">

    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&family=Source+Sans+Pro:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="개발 공부하는 블로그" />
    <link rel="shortcut icon" href="https://heejung-gjt.github.io/assets/built/images/favicon.png" type="image/png" />
    <link rel="canonical" href="https://heejung-gjt.github.io/oauth" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="studying developer" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="OAuth2.0에 대해 알아보기" />
    <meta property="og:description" content="OAuth란 인터넷 사용자들이 비밀번호를 제공하지 않고 다른 웹 사이트 상의 자신들의 정보에 대해 웹사이트나 애플리케이션의 접근 권한을 부여할 수 있는 공통적인 수단으로서 사용되는, 접근 위임을 위한 개방형 표준이다. 즉 웹,앱 서비스에서 제한적으로 권한을 요청해 사용할 수 있는 키를 발급해주는 것을 말한다 쉽게 말해 사이트의 회원가입 없이 이미 회원가입 되어있는 다른" />
    <meta property="og:url" content="https://heejung-gjt.github.io/oauth" />
    <meta property="og:image" content="https://heejung-gjt.github.io/assets/built/images/oauth.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2021-09-01T12:00:00+09:00" />
    <meta property="article:modified_time" content="2021-09-01T12:00:00+09:00" />
    <meta property="article:tag" content="Oauth" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="OAuth2.0에 대해 알아보기" />
    <meta name="twitter:description" content="OAuth란 인터넷 사용자들이 비밀번호를 제공하지 않고 다른 웹 사이트 상의 자신들의 정보에 대해 웹사이트나 애플리케이션의 접근 권한을 부여할 수 있는 공통적인 수단으로서 사용되는, 접근 위임을 위한 개방형 표준이다. 즉 웹,앱 서비스에서 제한적으로 권한을 요청해 사용할 수 있는 키를 발급해주는 것을 말한다 쉽게 말해 사이트의 회원가입 없이 이미 회원가입 되어있는 다른" />
    <meta name="twitter:url" content="https://heejung-gjt.github.io/" />
    <meta name="twitter:image" content="https://heejung-gjt.github.io/assets/built/images/oauth.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="studying developer" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Oauth" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "studying developer",
        "logo": "https://heejung-gjt.github.io/"
    },
    "url": "https://heejung-gjt.github.io/oauth",
    "image": {
        "@type": "ImageObject",
        "url": "https://heejung-gjt.github.io/assets/built/images/oauth.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://heejung-gjt.github.io/oauth"
    },
    "description": "OAuth란 인터넷 사용자들이 비밀번호를 제공하지 않고 다른 웹 사이트 상의 자신들의 정보에 대해 웹사이트나 애플리케이션의 접근 권한을 부여할 수 있는 공통적인 수단으로서 사용되는, 접근 위임을 위한 개방형 표준이다. 즉 웹,앱 서비스에서 제한적으로 권한을 요청해 사용할 수 있는 키를 발급해주는 것을 말한다 쉽게 말해 사이트의 회원가입 없이 이미 회원가입 되어있는 다른"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="OAuth2.0에 대해 알아보기" href="/feed.xml" />

    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LESPMGXKR3"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-LESPMGXKR3');
</script>
</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://heejung-gjt.github.io/">studying developer</a>
            
        
        
            
<ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <!-- <li class="nav-about" role="menuitem"><a href="/about/">About</a></li> -->
    <li class="nav-jekyll" role="menuitem"><a href="/tag/wanted/">원티드</a></li>
    <li class="nav-jekyll" role="menuitem"><a href="/tag/project/">프로젝트TIL</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/js/">JavaScript</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/python/">Python</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/django/">Django</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/celery/">Celery</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/rabbitmq/">RabbitMQ</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/oauth/">OAuth</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/jwt/">JWT</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/cors/">CORS</a></li>
    <li class="nav-jekyll" role="menuitem"><a href="/tag/linux/">linux</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/algorithm/">algorithm</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/coding/">코테</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/network/">Network</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/os/">OS</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/database/">DataBase</a></li>
    <li class="nav-python" role="menuitem"><a href="/tag/aws/">AWS</a></li>
    <li class="nav-jekyll" role="menuitem"><a href="/tag/git/">Git</a></li>
    <li class="nav-jekyll" role="menuitem"><a href="/tag/til/">TIL</a></li>


<!--    <li class="nav-archive" role="menuitem">-->
<!--        <a href="_includes/archive.html">All Posts</a>-->
<!--    </li>-->
</ul>
        
    </div>
    <!-- subscribe 안함
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Subscribe</a>
        
    </div>-->
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-oauth post tag oauth ">

            <header class="post-full-header">

              <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="2021-09-01">2021-09-01</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/oauth/'>OAUTH</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">OAuth2.0에 대해 알아보기</h1>
            </header>

<!--  
            
            <figure class="post-full-image" style="background-image: url(/assets/built/images/oauth.png)">
            </figure>
            
-->

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    
<p><br /></p>

<h2 id="oauth란">OAuth란</h2>

<p>인터넷 사용자들이 비밀번호를 제공하지 않고 다른 웹 사이트 상의 자신들의 정보에 대해 웹사이트나 애플리케이션의 접근 권한을 부여할 수 있는 공통적인 수단으로서 사용되는, 접근 위임을 위한 개방형 표준이다. 즉 <strong>웹,앱 서비스에서 제한적으로 권한을 요청해 사용할 수 있는 키를 발급해주는 것을 말한다</strong></p>

<p>쉽게 말해 사이트의 회원가입 없이 이미 회원가입 되어있는 다른 사이트로 로그인 하는 것이다.  아래의 그림처럼  OAuth인증은 3가지에 대한 용어를 
알아야 한다.</p>

<p>이해가 가지 않아도 일단 OAuth는 resource owner와 client, resource server 사이에서 정보의 요청/응답/인증이 이루어진다고 생각하자</p>

<p><img src="https://user-images.githubusercontent.com/64240637/131677827-9c80179f-b2e0-409b-b887-84ccfdfaf4c3.png" alt="oauth" /></p>

<ul>
  <li><strong>Resource Owner</strong> : 서비스를 이용하려는 사용자</li>
  <li><strong>Client</strong> : 소셜 서비스와 연동시키려는 웹 서비스</li>
  <li><strong>Resource Server</strong> (+ Authorization Server) : 연동하고자 하는 소셜 서비스의 서버(access token, refresh token등을 발급/재발급 해주는 역할)</li>
  <li><strong>Access Token</strong> : 인증 후에 사용자가 서비스 제공자가 아닌 소비자를 통해서 보호된 자원에 접근하기 위한 키를 포함한 값(Authorization Server로부터 발급받은 인증 토큰으로 Resource Server에 전달하여 서비스를 제공받을 수 있다)</li>
</ul>

<hr />

<h2 id="oauth를-쓰는-이유">OAuth를 쓰는 이유</h2>
<p>일반적으로 생각해 보았을때 우리는 보통 어떠한 사이트에 회원가입할때 소셜로 로그인 할 수 있으면 소셜을 보통 사용하지 않는가? 내 정보를 일일히 적는거 너무 귀찮다..  가끔은 비밀번호를 까먹기도 한다. 이러한
이유 때문에 OAuth를 쓰는것이다.</p>

<p>정리를 하면 <strong>애플리케이션에서 일일히 계정을 만들어 사용하게 되면 id/pwd 관리가 어렵고 개인정보 유출등 보안적으로 취약하기 때문에 이미 보안이 검증된 사이트의 API를 이용해 인증을 받아 보안적으로 안정을 유지하기 위해 사용한다</strong></p>

<hr />

<h2 id="oauth의-과정">OAuth의 과정</h2>

<p>처음 과정에 대해서 보게 되면 굉장히 복잡해 보인다. :-) 하지만 겁먹을 필요가 없다. 눈에 익지 않아서 그렇지 여러번 보면 패턴이 정해져 있기 때문에
수월하게 공부할 수 있을 것이다. (코드로 작성하는 방식은 비슷비슷 하기 때문에 이론적인 부분을 제대로 공부하자)</p>

<p>페이코 사이트에서 프로세스 과정을 캡쳐해 왔다. 아래의 1 - 6 과정 옆에 과정의 단계를 써놓았다.</p>

<p><img src="https://user-images.githubusercontent.com/64240637/131858267-2353d465-7c82-4e1f-acd3-c1db8a302ec9.png" alt="payco" /></p>
<h4 id="1-client가-resource-server에-oauth-사용-요청을-한다">1. client가 resource server에 oauth 사용 요청을 한다</h4>

<h4 id="2-resource-server가-client-id와-client-secret정보를-제공한다">2. resource server가 client id와 client secret정보를 제공한다</h4>

<p>(여기까지는 kakao developer 사이트에 들어가 직접 설정해주면 된다.
이때 리다이렉트 uri와 유저의 어떤 정보를 받을지에 대한 범위를 정해준다)</p>

<h4 id="3-resource-owner-가-client에서-소셜-로그인-버튼을-누르면-resource-server의-로그인-창으로-리다이렉트되고-client에서-어떤-정보가-필요하고-이를-승인하는지에-대해-묻는다-1234">3. resource owner 가 client에서 소셜 로그인 버튼을 누르면 resource server의 로그인 창으로 리다이렉트되고 client에서 어떤 정보가 필요하고 이를 승인하는지에 대해 묻는다 (1,2,3,4)</h4>

<h4 id="4-동의-버튼을-누르면-resource-server는-미리-지정해놓았던-client-uri로-리다이렉트-되고-code를-제공한다56">4. 동의 버튼을 누르면 resource server는 미리 지정해놓았던 client uri로 리다이렉트 되고 code를 제공한다(5,6)</h4>

<h4 id="5-client는-code값과-client-id-client-secret값을-다시-resource-server로-보내어-인증된-client가-맞는지-확인한다7">5. client는 code값과 client id, client secret값을 다시 resource server로 보내어 인증된 client가 맞는지 확인한다(7)</h4>

<h4 id="6-확인되면-resource-server는-access-token을-client에게-발급하고-client는-해당-토큰을-이용해-resource-owner의-정보를-가져와-사용할-수-있다8">6. 확인되면 resource server는 access token을 client에게 발급하고 client는 해당 토큰을 이용해 resource owner의 정보를 가져와 사용할 수 있다(8)</h4>

<hr />

<h2 id="서비스-등록">서비스 등록</h2>
<p>위의 과정 1,2번에 대한 설명을 잠깐 하고 넘어가겠다</p>

<p>먼저 OAuth 인증을 하기 위해서는 연동하고자 하는 소셜 서비스에 OAuth인증을 사용할 애플리케이션을 등록해야 한다
예를 들어 https://neonews.site url을 가지는 웹 사이트에서 카카오톡 OAuth인증을 이용해 회원가입/로그인을 하려고 할때 카카오톡 api 사이트에 들어가 사용할 웹사이트를 등록해주어야 한다.</p>

<p>이때 카카오톡 사이트에 미리 등록해야 할 url이 있다. 바로 <strong>리다이렉션 url</strong> 이다. 사용자가 카카오톡 인증 서버에 정보를 입력하면 
카카오톡에서 정보에 대한 유효성을 검증한 후 유효한 정보라면 유저의 정보를 애플리케이션에 전송하기 위해 
(애플리케이션에 유저의 정보를 전송해야 현재 로그인한 유저가 누구인지 식별이 가능하다) 
미리 카카오톡 사이트에 등록한 리다이렉션 url로 데이터를 전송한다</p>

<p>이때 알고있어야 하는 것은 OAuth은 단순히 정보가 유효한지에 대한 인증을 해주며 유저의 정보는 애플리케이션에서 관리한다 !</p>

<h2 id="access-token">Access Token</h2>
<p>Access Token에 대해 조금 더 자세히 알아보자</p>

<p>유저의 정보를 리다이렉션 url을 통해 애플리케이션에 보내기 전 보안을 위해 OAuth에서 리다이렉션 url에 code라는 매개변수 정보를 추가하여 보낸다.</p>

<p>애플리케이션은 해당 Code를 얻은 후 해당 Code를 통해 유저의 카카오톡 계정 정보에 접근할 수 있는 액세스 토큰을 얻게 된다. 이때 해당 액세스 토큰을 얻기 위해 카카오톡 oauth url에 code 정보를 포함하여 요청을 보낸다. (code정보 , 카카오톡에 웹 서비스 등록시 발급받은 클라이언트 id, 클라이언트 secret 정보, 동일한 리다이렉션url 정보를 포함한다)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"https://kauth.kakao.com/oauth/token?grant_type=authorization_code&amp;client_id={client_id}&amp;redirect_uri={REDIRECT_URI}&amp;code={code}&amp;client_secret={client_secret}"</span>
</code></pre></div></div>
<p>client가 resource server에게 사용자 정보를 요청하기 위한 입장권과 같은 것
  입장권에는 유효기간이 존재한다. 각 provider마다 다르다. 해당 유효기간이 지나면 더이상 해당 토큰을 사용할 수 없다</p>

<h2 id="refresh-token">Refresh Token</h2>
<p>위 access token이 유효기간이 만료되면, 새로운 access token을 발급받기 위해 필요한 토큰이다
  이 토큰에도 유효기간이 있다. 각 provider마다 다르다. Access token보다는 유효기간이 훨씬 길다</p>

<hr />

<p><br /></p>

<h2 id="실습을-진행해보자">실습을 진행해보자</h2>
<p>장고를 통해 kakao 소셜 로그인을 구현하였다.</p>

<p>먼저 kakao site에서 발급받은 kakao id와 secret_key를 settings.py에 입력한다. 이때 이 key들은 외부에<br />
보여지면 안되기 때문에 env파일에 넣어 불러와 사용하였다</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># settings.py</span>

<span class="n">KAKAO_ID</span><span class="o">=</span><span class="n">env</span><span class="p">(</span><span class="s">'KAKAO_ID'</span><span class="p">)</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="n">env</span><span class="p">(</span><span class="s">'SECRET_KEY'</span><span class="p">)</span>
</code></pre></div></div>
<p><br /></p>

<p>resource server와 owner가 리다이렉트 할 url을 작성한다</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># urls.py</span>

<span class="n">path</span><span class="p">(</span><span class="s">'signin/kakao/'</span><span class="p">,</span> <span class="n">kakao_login</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'kakao_login'</span><span class="p">),</span>
  <span class="n">path</span><span class="p">(</span><span class="s">'signin/kakao/callback/'</span><span class="p">,</span> <span class="n">kakao_login_callback</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'kakao-callback'</span><span class="p">),</span>
</code></pre></div></div>
<p><br /></p>

<p>except KakaoException()를 사용하기 위해 해당 class 를 import해서 사용했다(꼭 이 방법이 아니어도 된다 !!)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># exception.py</span>

<span class="k">class</span> <span class="nc">SocialLoginException</span><span class="p">(</span><span class="nb">Exception</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">KakaoException</span><span class="p">(</span><span class="nb">Exception</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div></div>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># signin.html</span>


<span class="o">&lt;</span><span class="n">a</span> <span class="n">class</span><span class="o">=</span><span class="s">"login-kakao"</span> <span class="n">href</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">url 'user:kakao_login' </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;</span><span class="err">카카오톡으로</span> <span class="err">로그인하기</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>

</code></pre></div></div>

<p><br /></p>

<p>카카오 로그인 버튼을 누르면 카카오 로그인 창으로 리다이렉트 시켜주기 위해 redirect_uri에 미리 정해놓았던 uri를 입력한다.(미리 카카오 서버와 약속한 uri) 카카오 서버에서의 인증이 성공하면 kakao api가 유저를 설정해놓은 redirect_uri로 보내서 다시 kakao_login_callback로 돌아오게 한다</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># views.py</span>

<span class="k">def</span> <span class="nf">kakao_login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">client_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"KAKAO_ID"</span><span class="p">)</span>
    <span class="n">redirect_uri</span> <span class="o">=</span> <span class="s">"http://127.0.0.1:8000/user/signin/kakao/callback"</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">f</span><span class="s">"https://kauth.kakao.com/oauth/authorize?client_id={client_id}&amp;redirect_uri={redirect_uri}&amp;response_type=code"</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<p>카카오톡 로그인창에 입력한 유저의 정보를 웹사이트에 보내기전 보안을 위해 OAauth에서 리다이렉션 url에 code라는 매개변수 정보를 추가하여 보낸다. 웹 사이트는 해당 code를 얻은 후 이 code를 통해 유저의 카카오톡 계정 정보에 접근할 수 있는 Access_token을 얻게 된다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">kakao_login_callback</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'code'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">code</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">KakaoException</span><span class="p">(</span><span class="s">"Can't get code"</span><span class="p">)</span>
    <span class="n">client_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"KAKAO_ID"</span><span class="p">)</span>
    <span class="n">redirect_uri</span> <span class="o">=</span> <span class="s">"http://127.0.0.1:8000/user/signin/kakao/callback"</span>
    <span class="n">client_secret</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'SECRET_KEY'</span><span class="p">)</span>
    <span class="n">request_access_token</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">f</span><span class="s">"https://kauth.kakao.com/oauth/token?grant_type=authorization_code&amp;client_id={client_id}&amp;redirect_uri={redirect_uri}&amp;code={code}&amp;client_secret={client_secret}"</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">"Accept"</span><span class="p">:</span> <span class="s">"application/json"</span><span class="p">},</span>
        <span class="p">)</span>
    <span class="n">token_info_json</span> <span class="o">=</span> <span class="n">request_access_token</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">token_info_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"error"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">KakaoException</span><span class="p">()</span>
    <span class="n">access_token</span> <span class="o">=</span> <span class="n">token_info_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"access_token"</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<p>Access Token을 통해 사용자 정보를 요청한다. 사용자 정보 요청은 사용자의 id나 카카오 계정 이메일등 상세 정보를 얻어 올 수 있는 기능이다. 이를 위해서 Bearer {access_token} 헤더를 담은 요청을 kakao 서버에 보낸다. 요청을 받은 서버에서는 유효성 검증 후 정보를 보낸다</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">profile_request</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s">"https://kapi.kakao.com/v2/user/me"</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">"Authorization"</span><span class="p">:</span> <span class="n">f</span><span class="s">"Bearer {access_token}"</span><span class="p">},</span>
    <span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<p>받아온 정보를 get을 통해 얻어올 수 있다. 이후 서비스의 로그인 시스템에 받아온 데이터를 가지고 적용시켜주면 된다 (user DB등에 등록)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">profile_json</span> <span class="o">=</span> <span class="n">profile_request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">kakao_account</span> <span class="o">=</span> <span class="n">profile_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"kakao_account"</span><span class="p">)</span>
    <span class="n">nickname</span> <span class="o">=</span> <span class="n">kakao_account</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"nickname"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">kakao_account</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"email"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">user</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">created</span><span class="p">:</span>
        <span class="n">user</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">nickname</span> <span class="o">=</span> <span class="n">nickname</span>
        <span class="n">user</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">auth</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
    <span class="n">auth</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
</code></pre></div></div>

<p><br />
<br /></p>

<hr />

<p>reference</p>

<p><a href="https://velog.io/@piecemaker/OAuth2-%EC%9D%B8%EC%A6%9D-%EB%B0%A9%EC%8B%9D%EC%97%90-%EB%8C%80%ED%95%B4-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90">https://velog.io/@piecemaker/OAuth2-%EC%9D%B8%EC%A6%9D-%EB%B0%A9%EC%8B%9D%EC%97%90-%EB%8C%80%ED%95%B4-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90</a></p>

                </div>
            </section>
        
        <div id="post-disqus" class="container">
            <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://heejung-gjt-github-io.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

        </div>
        



    </div>
</main>

        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://heejung-gjt.github.io/">studying developer</a> &copy; 2021</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://github.com/heejung-gjt" target="_blank" rel="noopener">heejung's GitHub Pages</a>
<!--                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener"></a>-->
                </section>
                <nav class="site-footer-nav">
<!--                    <a href="/">Latest Posts</a>-->
                    
                    
                    <a href="https://heejung-gjt.github.io" target="_blank" rel="noopener">github blog</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
        <div id="subscribe" class="subscribe-overlay">
            <a class="subscribe-overlay-close" href="#"></a>
            <div class="subscribe-overlay-content">
                
                <h1 class="subscribe-overlay-title">Subscribe to studying developer</h1>
                <p class="subscribe-overlay-description">Stay up to date! Get all the latest &amp; greatest posts delivered straight to your inbox</p>
<!--                <!--
<form method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  /><input class="location" type="hidden" name="location"  /><input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" type="email" name="email"  placeholder="youremail@example.com" />
    </div>
    <button class="" type="submit" disabled><span>Subscribe</span></button>
    <script type="text/javascript">(function(g,h,o,s,t){h[o]('.location')[s]=h[o]('.location')[s] || g.location.href;h[o]('.referrer')[s]=h[o]('.referrer')[s] || h.referrer;})(window,document,'querySelector','value');</script>
</form>
-->-->
            </div>
        </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'G-LESPMGXKR3', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->
    <script id="dsq-count-scr" src="//heejung-gjt-github-io.disqus.com/count.js" async></script>
</body>
</html>
